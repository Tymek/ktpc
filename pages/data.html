<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Krajowa Tablica Przeznaczeń Częstotliwości</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"
      integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <h1>Krajowa Tablica Przeznaczeń Częstotliwości</h1>
    <canvas id="canvas" style="width: 100%"></canvas>

    <script>
      const loadData = async () => {
        const response = await fetch("./data.csv");
        const text = await response.text();
        const {
          data,
          meta: { delimiter, linebreak },
        } = Papa.parse(text);

        const pages = data.reduce(
          (acc, row) => {
            if (row[0] === "") {
              acc.push([]);
            } else {
              acc[acc.length - 1].push(row);
            }
            return acc;
          },
          [[]]
        );

        const formattedPages = pages
          .filter((page) => page.length)
          .map((page) => {
            const pageNumber = page[page.length - 1][0];
            const header = page[0];
            const content = page.slice(1, -1);
            return { pageNumber, header, content };
          });

        console.log(formattedPages);
      };

      loadData();
    </script>
  </body>
</html>
